<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QurMa Portal - IAI Persis Bandung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/kfgqpc-uthman-taha-naskh-2" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: { 
                    colors: { primary: '#022c22', gold: '#c5a059', darkBg: '#0f172a' } 
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; transition: background-color 0.5s ease; -webkit-tap-highlight-color: transparent; }
        
        /* Arab Al-Quran */
        .arabic { font-family: 'KFGQPC Uthman Taha Naskh', serif; font-size: 2.2rem; line-height: 4.8rem; text-align: right; direction: rtl; }
        
        /* Arab Hadis & Doa (Dibuat Seragam) */
        .hadith-arabic, .arabic-doa { 
            font-family: 'Scheherazade New', serif; 
            direction: rtl; 
            line-height: 1.8; 
            text-align: right;
            font-size: 2.5rem;
        }

        .hadith-row { display: block; margin-bottom: 2rem; }

        .ayah-ornamen {
            display: inline-flex; align-items: center; justify-content: center; position: relative;
            width: 34px; height: 34px; margin-right: 10px; margin-left: 4px; vertical-align: middle;
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 10px; font-weight: 700; color: #c5a059; z-index: 1; transform: translateY(-2px);
        }
        .ayah-ornamen::before { content: ""; position: absolute; inset: 0; border: 1px solid #c5a059; opacity: 0.5; transform: rotate(45deg); border-radius: 4px; z-index: -1; }

        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .dark .glass-nav { background: rgba(15, 23, 42, 0.85); }
        .nav-hidden { transform: translateY(-100%); }
        .player-hidden { transform: translate(-50%, 250%) !important; }

        .ayat-card { transition: all 0.3s ease; border: 1px solid rgba(0,0,0,0.03); scroll-margin-top: 100px; cursor: pointer; }
        .active-ayat { border-left: 5px solid #c5a059 !important; background: linear-gradient(90deg, rgba(197, 160, 89, 0.1) 0%, transparent 100%) !important; }

        .tafsir-content { max-height: 0; overflow: hidden; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; }
        .tafsir-content.open { max-height: 5000px; opacity: 1; }
        
        .islamic-pattern { background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 0l10 20-10 20L10 20z' fill='%23c5a059' fill-opacity='0.02'/%3E%3C/svg%3E"); }
        .loader { border-top-color: #c5a059; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Murojaah Word Puzzle */
        .word { background: #022c22; color: white; padding: 10px 15px; border-radius: 10px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 0 #000; margin: 4px; }
        .drop-zone { min-height: 80px; border: 2px dashed #c5a059; border-radius: 15px; padding: 12px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; background: rgba(255,255,255,0.5); direction: rtl; }
        .dark .drop-zone { background: rgba(15, 23, 42, 0.5); }

        .tafsir-content p {
            text-indent: 1.5rem;
            margin-bottom: 1rem;
        }

        .tafsir-content h4 {
            text-indent: 0;
        }

        #hadithNumberGrid div:active {
            transform: scale(0.9);
            background-color: #c5a059;
            color: #022c22;
        }

        @media (max-width: 640px) {
            .hadith-arabic, .arabic-doa { 
                font-size: 1.8rem; 
                line-height: 1.6;
            }
            #doaGrid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 0.75rem;
            }
            main {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .word {
                font-size: 1rem;
                padding: 8px 12px;
            }
        }

        #doaModal {
            transition: opacity 0.3s ease;
        }
        
        input, select, textarea {
            font-size: 16px !important;
        }
    </style>
</head>
<body onclick="toggleFocusMode(event)" class="bg-[#fcfdfd] dark:bg-darkBg text-slate-800 dark:text-slate-200 min-h-screen islamic-pattern overflow-x-hidden">

    <div id="landingPage" class="min-h-screen flex flex-col items-center justify-center p-6">
        <div class="text-center mb-12">
            <div class="w-20 h-20 bg-primary rounded-[2rem] flex items-center justify-center shadow-2xl mx-auto mb-6 rotate-2">
                <span class="text-gold font-bold text-4xl italic">Q</span>
            </div>
            <h1 class="text-3xl md:text-5xl font-black text-primary dark:text-white mb-2 tracking-tighter">QurMa Portal</h1>
            <p class="text-slate-500 font-medium italic">IAI Persis Bandung Digital Library</p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 w-full max-w-7xl">
            <button onclick="openModule('quran')" class="group p-8 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-slate-100 dark:border-slate-800 hover:border-gold transition-all text-left shadow-xl">
                <div class="w-14 h-14 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center mb-6 transition-transform group-hover:scale-110"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg></div>
                <h2 class="text-xl font-black text-primary dark:text-white mb-2 uppercase tracking-tight">Al-Qur'an</h2>
                <p class="text-slate-500 text-xs">Mushaf digital lengkap dengan audio 6 Qori.</p>
            </button>

            <button onclick="openModule('murojaah')" class="group p-8 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-slate-100 dark:border-slate-800 hover:border-gold transition-all text-left shadow-xl">
                <div class="w-14 h-14 bg-amber-50 text-amber-600 rounded-2xl flex items-center justify-center mb-6 transition-transform group-hover:scale-110"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg></div>
                <h2 class="text-xl font-black text-primary dark:text-white mb-2 uppercase tracking-tight">Murojaah</h2>
                <p class="text-slate-500 text-xs">Uji hafalan dengan Susun Kata & Sambung Ayat.</p>
            </button>

            <button onclick="openModule('hadith')" class="group p-8 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-slate-100 dark:border-slate-800 hover:border-gold transition-all text-left shadow-xl">
                <div class="w-14 h-14 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-6 transition-transform group-hover:scale-110"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg></div>
                <h2 class="text-xl font-black text-primary dark:text-white mb-2 uppercase tracking-tight">Kitab Hadis</h2>
                <p class="text-slate-500 text-xs">Kumpulan hadis dari Kutubut Tis'ah.</p>
            </button>

            <button onclick="openModule('doa')" class="group p-8 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-slate-100 dark:border-slate-800 hover:border-gold transition-all text-left shadow-xl">
                <div class="w-14 h-14 bg-rose-50 text-rose-600 rounded-2xl flex items-center justify-center mb-6 transition-transform group-hover:scale-110"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg></div>
                <h2 class="text-xl font-black text-primary dark:text-white mb-2 uppercase tracking-tight">Doa-Doa</h2>
                <p class="text-slate-500 text-xs">Kumpulan doa harian digital lengkap.</p>
            </button>

            <a href="https://ai.studio/apps/drive/1gI-wg9zzRsQac_fhSYF3RrDXaAVzgNOj" target="_blank" class="group p-8 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-slate-100 dark:border-slate-800 hover:border-indigo-500 transition-all text-left shadow-xl">
                <div class="w-14 h-14 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center mb-6 transition-transform group-hover:scale-110">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <h2 class="text-xl font-black text-primary dark:text-white uppercase tracking-tight">Qurma AI</h2>
                    <span class="bg-indigo-600 text-white text-[8px] px-1.5 py-0.5 rounded-md font-bold">PRO</span>
                </div>
                <p class="text-slate-500 text-xs">Asisten cerdas berbasis AI untuk tanya jawab Islami.</p>
            </a>
        </div>
        
        <footer class="mt-20 w-full border-t border-slate-200 dark:border-slate-800 py-8">
            <div class="container mx-auto px-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="text-center md:text-left">
                        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">&copy; 2026 IAI Persis Bandung.</p>
                        <p class="text-[10px] text-slate-400 dark:text-slate-500 uppercase tracking-widest mt-1">Digital Library & Islamic Portal</p>
                    </div>
                    <div class="flex items-center gap-2 opacity-60">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Powered by</span>
                        <span class="text-xs font-bold text-emerald-600">equran.id</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <div id="moduleQuran" class="hidden">
        <nav id="mainNav" class="glass-nav fixed top-0 left-0 right-0 z-50 border-b border-slate-200 dark:border-slate-800 h-16 md:h-20 flex items-center">
            <div class="container mx-auto px-4 md:px-6 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <button onclick="backToLanding()" class="w-10 h-10 md:w-11 md:h-11 bg-primary rounded-xl flex items-center justify-center shadow-lg"><span class="text-gold font-bold text-xl italic">Q</span></button>
                    <button id="btnBackToList" onclick="backToListSurat()" class="hidden p-2.5 bg-slate-100 dark:bg-slate-800 rounded-xl text-primary dark:text-gold font-black text-[10px] flex items-center gap-1 uppercase tracking-tighter shadow-sm border border-slate-200 dark:border-slate-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="3" d="M15 19l-7-7 7-7"/></svg> Kembali
                    </button>
                </div>
                <h1 class="font-black text-primary dark:text-white italic uppercase text-[10px] md:text-xs tracking-[0.2em]">QurMa Mushaf</h1>
                <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-xl bg-white dark:bg-slate-800 flex items-center justify-center border border-slate-200 dark:border-slate-700 shadow-sm active:scale-90 transition-all">
                    <svg id="themeIcon" class="h-5 w-5 text-primary dark:text-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"></svg>
                </button>
            </div>
        </nav>
        <main class="container mx-auto px-4 pt-24 pb-12 max-w-5xl">
            <div id="quranHeader" class="max-w-2xl mx-auto mb-8 space-y-4">
                <input type="text" id="searchInput" oninput="handleSearch(this.value)" placeholder="Cari nama surat..." class="w-full bg-white dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 py-4 px-6 rounded-2xl focus:border-gold outline-none shadow-sm text-sm">
                <div id="lastAudioWidget" class="hidden p-5 bg-primary dark:bg-slate-900 border border-gold/20 rounded-2xl flex justify-between items-center shadow-lg transition-all active:scale-95 cursor-pointer" onclick="jumpToLastAudio()">
                    <div class="flex items-center gap-4 text-left">
                        <div class="w-10 h-10 bg-gold/10 text-gold rounded-full flex items-center justify-center animate-pulse"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg></div>
                        <div><p class="text-[9px] font-bold text-gold uppercase tracking-widest">Lanjutkan Tadarus</p><h4 id="lastAudioInfo" class="text-white font-bold text-sm"></h4></div>
                    </div>
                    <span class="text-[10px] font-bold text-gold/60 uppercase">Putar →</span>
                </div>
            </div>
            <div id="sectionHome"><div id="listSurat" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-5"></div></div>
            <div id="sectionDetail" class="hidden">
                <div id="infoSurat" class="bg-primary text-white p-8 md:p-16 rounded-[2rem] mb-8 text-center shadow-xl italic relative overflow-hidden"></div>
                <div id="ayatSearchBox" class="max-w-xs mx-auto mb-8 relative">
                    <input type="number" id="jumpAyatInput" placeholder="Ke Ayat Nomor..." class="w-full bg-white dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 py-3 px-6 rounded-2xl focus:border-gold outline-none shadow-sm text-sm text-center">
                    <button onclick="jumpToAyat()" class="absolute right-2 top-2 bg-gold text-primary p-2 rounded-xl shadow-md hover:bg-gold/80 transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
                    </button>
                </div>
                <div id="isiAyat" class="space-y-4 max-w-4xl mx-auto pb-48 text-left"></div>
            </div>
        </main>
        <div id="audioPlayerBar" class="fixed bottom-4 md:bottom-8 left-1/2 -translate-x-1/2 w-[95%] max-w-2xl bg-white/95 dark:bg-slate-900/95 backdrop-blur-2xl border border-slate-200 dark:border-slate-800 p-3 rounded-2xl z-50 hide-player-init flex flex-col md:flex-row items-center justify-between shadow-2xl transition-all duration-500 gap-3">
            <div class="flex items-center gap-3 w-full md:w-auto overflow-hidden text-left">
                <div class="w-10 h-10 bg-gold/10 text-gold rounded-xl flex items-center justify-center flex-shrink-0 animate-pulse"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg></div>
                <div class="overflow-hidden"><p id="playingTitle" class="font-black text-[10px] text-primary dark:text-white uppercase truncate"></p><p id="playingAyat" class="text-[8px] text-gold font-bold uppercase"></p></div>
            </div>
            <select id="qoriSelect" onchange="updateQori(this.value)" class="w-full md:w-40 bg-slate-100 dark:bg-slate-800 text-[10px] font-bold py-2 px-3 rounded-xl outline-none appearance-none cursor-pointer">
                <option value="05">Mishary Rashid</option><option value="03">As-Sudais</option><option value="01">Al-Juhany</option><option value="02">Al-Qasim</option><option value="04">Al-Dossari</option><option value="06">Akram Al-Alaqmi</option>
            </select>
            <div class="flex items-center gap-2">
                <button onclick="togglePlayPause()" class="w-11 h-11 bg-primary text-white rounded-full flex items-center justify-center shadow-lg active:scale-95 transition-transform"><svg id="mainToggleIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
                <button onclick="closePlayer()" class="text-slate-300 dark:text-slate-600 p-2"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
            </div>
            <audio id="mainAudio" class="hidden"></audio>
        </div>
    </div>

    <div id="moduleHadith" class="hidden">
        <nav class="glass-nav fixed top-0 left-0 right-0 z-50 border-b border-slate-200 dark:border-slate-800 h-16 md:h-20 flex items-center">
            <div class="container mx-auto px-4 md:px-6 flex justify-between items-center">
                <button onclick="backToLanding()" class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center shadow-lg"><span class="text-gold font-bold text-xl italic">Q</span></button>
                <h1 class="font-black text-primary dark:text-white italic uppercase text-[10px] md:text-xs tracking-[0.2em]">Pustaka Hadis</h1>
                <div class="w-10"></div>
            </div>
        </nav>
        <main class="container mx-auto px-4 pt-24 pb-12 max-w-5xl">
            <div id="hadithStep1" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            <div id="hadithStep2" class="hidden bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] shadow-xl border border-slate-100 dark:border-slate-800 text-center">
                <div class="flex flex-col md:flex-row items-center justify-between mb-8 border-b dark:border-slate-800 pb-6 gap-4">
                    <button onclick="showHadithStep(1)" class="text-gold font-bold text-sm">← Ganti Kitab</button>
                    <div><h2 id="hadithBookName" class="text-2xl font-black text-primary dark:text-white"></h2><p id="hadithTotalInfo" class="text-[10px] text-slate-400 font-bold uppercase"></p></div>
                    <div class="relative w-full md:w-64"><input type="number" id="hadithJumpInput" placeholder="No Hadis..." class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:bg-slate-800 dark:border-slate-700 outline-none text-sm"><button onclick="jumpToHadith()" class="absolute right-2 top-1 bg-primary text-gold px-3 py-1 rounded-lg text-xs font-bold">Cari</button></div>
                </div>
                <div id="hadithNumberGrid" class="grid grid-cols-4 sm:grid-cols-8 md:grid-cols-10 gap-3 max-h-[400px] overflow-y-auto p-4 border rounded-2xl bg-slate-50 dark:bg-slate-800/50 dark:border-slate-700"></div>
            </div>
            <div id="hadithStep3" class="hidden space-y-6">
                <button onclick="showHadithStep(2)" class="px-6 py-2 bg-white dark:bg-slate-900 rounded-full shadow-md text-primary dark:text-gold font-bold border dark:border-slate-800 text-xs">← Kembali ke Nomor</button>
                <div class="bg-white dark:bg-slate-900 rounded-[2.5rem] shadow-2xl border dark:border-slate-800 overflow-hidden">
                    <div class="bg-primary text-white p-8 border-b border-gold/20 flex justify-between items-center text-left">
                        <div><span id="hadithDetailBook" class="text-[9px] font-bold tracking-widest uppercase text-gold block mb-1"></span><span id="hadithDetailNum" class="text-xl font-black italic"></span></div>
                        <div class="text-3xl opacity-20">﷽</div>
                    </div>
                    <div class="p-8 md:p-14 text-center">
                        <div id="hadithArabic" class="hadith-arabic text-slate-800 dark:text-slate-100"></div>
                        <div class="py-12 flex items-center justify-center gap-6"><div class="h-px bg-slate-200 dark:bg-slate-800 w-16 md:w-24"></div><span class="text-[10px] font-bold text-gold uppercase tracking-widest">Terjemahan</span><div class="h-px bg-slate-200 dark:bg-slate-800 w-16 md:w-24"></div></div>
                        <p id="hadithIndo" class="text-slate-600 dark:text-slate-400 leading-relaxed italic md:text-lg max-w-3xl mx-auto mb-8"></p>
                        <div class="mt-8 pt-6 border-t dark:border-slate-800 flex justify-center">
                            <button onclick="shareHadithWA()" class="flex items-center gap-2 px-8 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-full font-bold text-sm transition-all active:scale-95 shadow-lg shadow-emerald-200 dark:shadow-none">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 100-5.368 3 3 0 000 5.368zm0 7.118a3 3 0 110 5.368 3 3 0 010-5.368z"></path></svg> Share Hadis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- CORE NAVIGATION ---
        let isBarsHidden = false;
        function toggleFocusMode(e) {
            if (e.target.closest('button') || e.target.closest('input') || e.target.closest('select') || e.target.closest('.tafsir-content') || e.target.closest('#doaModal') || e.target.closest('#moduleMurojaah')) return;
            isBarsHidden = !isBarsHidden;
            const nav = document.getElementById('mainNav');
            const footer = document.getElementById('audioPlayerBar');
            if(nav) nav.classList.toggle('nav-hidden', isBarsHidden);
            if(footer && !footer.classList.contains('hide-player-init')) footer.classList.toggle('player-hidden', isBarsHidden);
        }

        function openModule(type) {
            document.getElementById('landingPage').classList.add('hidden');
            document.querySelectorAll('div[id^="module"]').forEach(m => m.classList.add('hidden'));
            const modId = 'module' + type.charAt(0).toUpperCase() + type.slice(1);
            const mod = document.getElementById(modId);
            if(mod) {
                mod.classList.remove('hidden');
                if(type === 'quran') { backToListSurat(); fetchSurat(); } 
                else if(type === 'hadith') { loadHadithBooks(); showHadithStep(1); } 
                else if(type === 'doa') { fetchDoaList(); } 
                else if(type === 'murojaah') { showMurojaahScreen('screen-juz'); }
            }
        }

        function backToLanding() {
            closePlayer();
            document.querySelectorAll('div[id^="module"]').forEach(m => m.classList.add('hidden'));
            document.getElementById('landingPage').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // --- QURAN LOGIC ---
        let allSurat = [], currentSuratData = null, currentPlayingAyat = null, selectedQori = '05';
        const mainAudio = document.getElementById('mainAudio');
        function toArabicDigits(num) { return num.toString().split('').map(d => ['٠','١','٢','٣','٤','٥','٦','٧','٨','٩'][d]).join(''); }
        
        async function fetchSurat() {
            const res = await fetch('https://equran.id/api/v2/surat');
            const json = await res.json();
            allSurat = json.data;
            renderSurat(allSurat);
        }

        function renderSurat(data) {
            document.getElementById('listSurat').innerHTML = data.map(s => `
                <div onclick="getSuratDetail(${s.nomor})" class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] border border-slate-100 dark:border-slate-800 cursor-pointer text-left shadow-sm">
                    <div class="flex justify-between items-center mb-4"><span class="text-[9px] font-bold text-gold bg-gold/5 px-2 py-1 rounded">${s.nomor}</span><span class="arabic !text-xl text-primary dark:text-emerald-400">${s.nama}</span></div>
                    <h3 class="font-bold text-lg text-primary dark:text-white">${s.namaLatin}</h3>
                    <p class="text-[8px] font-bold opacity-40 uppercase tracking-widest">${s.arti} • ${s.jumlahAyat} Ayat</p>
                </div>`).join('');
        }

        // FUNGSI JUMP TO AYAT
        function jumpToAyat() {
            const num = document.getElementById('jumpAyatInput').value;
            if(!num) return;
            const el = document.getElementById(`ayat-${num}`);
            if(el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                el.classList.add('ring-2', 'ring-gold');
                setTimeout(() => el.classList.remove('ring-2', 'ring-gold'), 3000);
            } else {
                alert("Nomor ayat tidak ditemukan di surat ini.");
            }
        }

        async function getSuratDetail(nomor, targetAyat = null) {
            document.getElementById('sectionHome').classList.add('hidden'); 
            document.getElementById('quranHeader').classList.add('hidden'); 
            document.getElementById('sectionDetail').classList.remove('hidden'); 
            document.getElementById('btnBackToList').classList.remove('hidden');
            document.getElementById('isiAyat').innerHTML = `<div class="py-20 text-center text-gold animate-pulse text-[10px] uppercase">Memuat Kalamullah...</div>`;
            
            const [rs, rt] = await Promise.all([fetch(`https://equran.id/api/v2/surat/${nomor}`), fetch(`https://equran.id/api/v2/tafsir/${nomor}`)]);
            const js = await rs.json(), jt = await rt.json(); 
            currentSuratData = js.data;
            
            document.getElementById('infoSurat').innerHTML = `<h2 class="text-4xl font-black mb-2 text-white">${currentSuratData.namaLatin}</h2><p class="text-gold font-medium">${currentSuratData.nama} — ${currentSuratData.arti}</p>`;
            
            let html = nomor != 1 && nomor != 9 ? `<div class="arabic text-center py-10 opacity-40 italic text-2xl">بِسْمِ ٱللَّهِ ٱلرَّحْمَنِ ٱلرَّحِيمِ</div>` : "";
            html += currentSuratData.ayat.map((a, i) => `
                <div id="ayat-${a.nomorAyat}" onclick="handleAyatClick(${a.nomorAyat})" class="ayat-card bg-white dark:bg-slate-900 rounded-[2rem] overflow-hidden mb-4 border border-slate-50 dark:border-slate-800/50 p-8 md:p-12 shadow-sm">
                    <p class="arabic text-slate-800 dark:text-slate-100 leading-relaxed mb-8">${a.teksArab} <span class="ayah-ornamen">${toArabicDigits(a.nomorAyat)}</span></p>
                    <div class="space-y-3"><p class="text-gold text-[11px] font-bold italic">${a.teksLatin}</p><p class="text-slate-500 dark:text-slate-400 text-[12px] leading-relaxed">${a.teksIndonesia}</p></div>
                    <div class="mt-8 flex gap-3"><button onclick="shareWA(${a.nomorAyat}); event.stopPropagation();" class="px-5 py-2 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 text-[9px] font-black uppercase rounded-full">Share</button><button onclick="toggleTafsir(${a.nomorAyat}); event.stopPropagation();" class="px-5 py-2 bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-[9px] font-black uppercase rounded-full">Tafsir</button></div>
                    <div id="tafsir-${a.nomorAyat}" class="tafsir-content bg-slate-50 dark:bg-slate-800/30 text-justify px-6 md:px-12 mt-4 rounded-3xl transition-all">
                         <div class="py-6 space-y-4 text-sm md:text-base leading-relaxed text-slate-600 dark:text-slate-400">
                         <h4 class="font-bold text-primary dark:text-gold mb-2">Tafsir Kemenag:</h4>
                         ${jt.data.tafsir[i].teks.split('\n').map(p => p.trim() ? `<p class="mb-3">${p}</p>` : '').join('')}
                        </div></div>
                </div>`).join('');
            document.getElementById('isiAyat').innerHTML = html;
            if(targetAyat) setTimeout(() => playAudio(parseInt(targetAyat)), 800);
            window.scrollTo(0,0);
        }
        
        function backToListSurat() { 
            closePlayer(); 
            document.getElementById('sectionDetail').classList.add('hidden'); 
            document.getElementById('sectionHome').classList.remove('hidden'); 
            document.getElementById('quranHeader').classList.remove('hidden'); 
            document.getElementById('btnBackToList').classList.add('hidden'); 
            window.scrollTo(0,0); 
            checkLastAudio(); 
        }
        
        function handleAyatClick(num) { currentPlayingAyat === num ? togglePlayPause() : playAudio(num); }
        function playAudio(num) {
            const data = currentSuratData.ayat.find(a => a.nomorAyat === num); currentPlayingAyat = num;
            localStorage.setItem('qurma_last_audio', JSON.stringify({ nomor: currentSuratData.nomor, namaLatin: currentSuratData.namaLatin, ayat: num }));
            document.querySelectorAll('.ayat-card').forEach(el => el.classList.remove('active-ayat'));
            const el = document.getElementById(`ayat-${num}`); if(el) { el.classList.add('active-ayat'); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
            mainAudio.src = data.audio[selectedQori]; mainAudio.play();
            document.getElementById('playingTitle').innerText = currentSuratData.namaLatin; document.getElementById('playingAyat').innerText = `Ayat ${num}`;
            document.getElementById('audioPlayerBar').classList.remove('hide-player-init', 'player-hidden');
        }

        function togglePlayPause() { mainAudio.paused ? mainAudio.play() : mainAudio.pause(); }
        function closePlayer() { mainAudio.pause(); document.getElementById('audioPlayerBar').classList.add('hide-player-init'); currentPlayingAyat = null; }
        function checkLastAudio() { const last = JSON.parse(localStorage.getItem('qurma_last_audio')); if (last) { document.getElementById('lastAudioWidget').classList.remove('hidden'); document.getElementById('lastAudioInfo').innerText = `${last.namaLatin} - Ayat ${last.ayat}`; } }
        function jumpToLastAudio() { const last = JSON.parse(localStorage.getItem('qurma_last_audio')); if (last) getSuratDetail(last.nomor, last.ayat); }
        function updateQori(code) { selectedQori = code; if (currentPlayingAyat) playAudio(currentPlayingAyat); }
        function toggleTafsir(num) { document.getElementById(`tafsir-${num}`).classList.toggle('open'); }
        function shareWA(n) { const a = currentSuratData.ayat.find(x => x.nomorAyat === n); window.open(`https://wa.me/?text=${encodeURIComponent("*"+currentSuratData.namaLatin+" Ayat "+n+"*\n\n"+a.teksArab+"\n\n"+a.teksIndonesia)}`, '_blank'); }
        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); updateIcons(); }
        function updateIcons() { const isD = document.documentElement.classList.contains('dark'); const btn = document.getElementById('themeIcon'); if(btn) btn.innerHTML = isD ? '<path stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3" />' : '<path stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />'; }
        function handleSearch(val) { renderSurat(allSurat.filter(s => s.namaLatin.toLowerCase().includes(val.toLowerCase()))); }
        
        mainAudio.onplay = () => document.getElementById('mainToggleIcon').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
        mainAudio.onpause = () => document.getElementById('mainToggleIcon').innerHTML = '<path d="M8 5v14l11-7z"/>';
        mainAudio.onended = () => { if (currentPlayingAyat < currentSuratData.jumlahAyat) playAudio(currentPlayingAyat + 1); else closePlayer(); };

        // (Script Hadith, Murojaah, Doa tetap utuh di bawah...)
        // Tambahkan script penutup standar Anda di sini
        updateIcons();
        checkLastAudio();
    </script>
</body>
</html>
